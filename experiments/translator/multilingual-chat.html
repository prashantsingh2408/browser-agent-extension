<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Multilingual Chat - Translator API</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; min-height: 100vh; }
    .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 16px; padding: 30px; }
    h1 { color: #333; margin-bottom: 20px; }
    .status { padding: 12px; border-radius: 8px; margin-bottom: 20px; font-weight: 600; }
    .status.success { background: #e8f5e9; color: #2e7d32; }
    .chat-box { height: 400px; border: 2px solid #e0e0e0; border-radius: 8px; padding: 15px; overflow-y: auto; margin-bottom: 15px; }
    .message { margin-bottom: 15px; padding: 12px; border-radius: 8px; max-width: 80%; }
    .message.user { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-left: auto; }
    .message.translated { background: #f5f5f5; border-left: 4px solid #667eea; }
    input, select { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; margin-bottom: 10px; }
    button { width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üí¨ Multilingual Chat</h1>
    <div class="status">‚ö†Ô∏è Checking AI availability...</div>
    
    <label><strong>Your Language:</strong></label>
    <select id="userLang">
      <option value="en">English</option>
      <option value="es">Spanish</option>
      <option value="fr">French</option>
      <option value="de">German</option>
    </select>
    
    <div class="chat-box" id="chatBox"></div>
    
    <input id="messageInput" placeholder="Type your message..." />
    <button onclick="sendMessage()">Send & Translate</button>
  </div>

  <script>
    let apiMode = 'none';
    let legacySession = null;

    window.addEventListener('load', async () => {
      const status = document.querySelector('.status');
      
      if ('translation' in self) {
        status.className = 'status success';
        status.textContent = '‚úÖ Translation API Ready!';
        apiMode = 'modern';
      } else if (typeof LanguageModel !== 'undefined') {
        const avail = await LanguageModel.availability();
        if (avail === 'readily' || avail === 'available') {
          status.className = 'status success';
          status.innerHTML = '‚úÖ <strong>Legacy API Ready!</strong>';
          apiMode = 'legacy';
        }
      } else {
        status.style.background = '#fff3e0';
        status.style.color = '#e65100';
        status.innerHTML = '‚ö†Ô∏è Demo Mode';
        apiMode = 'demo';
      }
    });

    async function sendMessage() {
      const message = document.getElementById('messageInput').value.trim();
      if (!message) return;
      
      const chatBox = document.getElementById('chatBox');
      chatBox.innerHTML += `<div class="message user">${message}</div>`;
      
      let translation;
      if (apiMode === 'legacy') {
        if (!legacySession) {
          legacySession = await LanguageModel.create({ temperature: 0.3 });
        }
        const lang = document.getElementById('userLang').value;
        const langName = { es: 'Spanish', fr: 'French', de: 'German', en: 'English' }[lang];
        translation = await legacySession.prompt(`Translate to ${langName}: "${message}"`);
      } else {
        translation = `[Demo] Translated message`;
      }
      
      chatBox.innerHTML += `<div class="message translated">üìù ${translation}</div>`;
      chatBox.scrollTop = chatBox.scrollHeight;
      document.getElementById('messageInput').value = '';
    }
  </script>
</body>
</html>
