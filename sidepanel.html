<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Assistant</title>
  <link rel="stylesheet" href="styles/sidepanel.css">
  <link rel="stylesheet" href="styles/ux-enhancements.css">
</head>
<body>
  <div class="app">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <svg class="logo" width="24" height="24" viewBox="0 0 24 24" fill="none">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
          <circle cx="9" cy="10" r="1.5" fill="currentColor"/>
          <circle cx="15" cy="10" r="1.5" fill="currentColor"/>
          <path d="M8 14c0 2.21 1.79 4 4 4s4-1.79 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <div class="header-text">
          <h1 class="app-title">AI Assistant</h1>
          <span class="status" id="status">
            <span class="status-dot"></span>
            <span id="statusText">Online</span>
          </span>
        </div>
      </div>
      <div class="header-actions">
        <button class="header-btn" id="newChatBtn" title="New chat session">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 5v14M5 12h14"/>
          </svg>
        </button>
        <button class="header-btn" id="historyBtn" title="Chat history">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 3v5h5M3.05 13A9 9 0 1 0 6 5.3L3 8"/>
            <path d="M12 7v5l4 2"/>
          </svg>
        </button>
        <button class="header-btn" id="clearBtn" title="Clear current chat">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 6h18M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2m3 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6h14zM10 11v6M14 11v6"/>
          </svg>
        </button>
      </div>
    </header>

    <!-- Main Navigation Tabs -->
    <div class="main-nav-tabs">
      <button class="main-nav-tab active" data-tab="chat">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
        </svg>
        Chat
      </button>
      <button class="main-nav-tab" data-tab="mail">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
          <polyline points="22,6 12,13 2,6"/>
        </svg>
        Craft Mail
      </button>
      <button class="main-nav-tab" data-tab="agent">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <path d="M12 6v6l4 2"/>
        </svg>
        Agent
      </button>
    </div>

    <!-- Chat Section -->
    <div class="main-tab-content" id="chatSection" style="display: flex; flex-direction: column; flex: 1;">
      <!-- Chat Tabs -->
      <div class="chat-tabs" id="chatTabs">
      <div class="tabs-container">
        <div class="tab active" data-session-id="default">
          <span class="tab-title">Chat 1</span>
          <button class="tab-close" title="Close tab">√ó</button>
        </div>
      </div>
      <button class="new-tab-btn" id="newTabBtn" title="New chat tab">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 5v14M5 12h14"/>
        </svg>
      </button>
    </div>

    <!-- Chat History Sidebar -->
    <div class="history-sidebar" id="historySidebar">
      <div class="history-header">
        <h3>Chat History</h3>
        <button class="close-history" id="closeHistoryBtn">√ó</button>
      </div>
      <div class="history-content">
        <div class="history-search">
          <input type="text" id="historySearch" placeholder="Search chats..." />
        </div>
        <div class="history-list" id="historyList">
          <!-- History items will be populated here -->
        </div>
      </div>
    </div>

    <!-- Chat Container -->
    <div class="chat-container" id="messages">
      <!-- Welcome Message - Enhanced with UX Laws -->
      <div class="welcome-message">
        <div class="welcome-animation">
          <div class="welcome-icon">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
              <circle cx="12" cy="12" r="10" stroke="url(#gradient)" stroke-width="1.5"/>
              <circle cx="9" cy="10" r="1.5" fill="url(#gradient)"/>
              <circle cx="15" cy="10" r="1.5" fill="url(#gradient)"/>
              <path d="M8 14c0 2.21 1.79 4 4 4s4-1.79 4-4" stroke="url(#gradient)" stroke-width="1.5" stroke-linecap="round"/>
              <defs>
                <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#4285f4;stop-opacity:1" />
                </linearGradient>
              </defs>
            </svg>
          </div>
          <div class="pulse-ring"></div>
        </div>
        <h2 class="gradient-text">Hello! Ready to assist you</h2>
        <p class="subtitle">Powered by Chrome AI ‚Ä¢ Lightning fast ‚Ä¢ Always private</p>
        <div class="suggestions">
          <button class="suggestion-chip action-chip" data-action="summarize">üìÑ Summarize this page</button>
          <button class="suggestion-chip action-chip" data-action="explain-selection">üí° Explain selected text</button>
          <button class="suggestion-chip action-chip" data-action="explain-video">üé• Explain intro video</button>
          <button class="suggestion-chip" data-suggestion="What can you help me with?">‚ùì What can you do?</button>
        </div>
      </div>
    </div>

    <!-- Input Container -->
    <div class="input-container">
      <!-- Quick Action Buttons -->
      <div class="quick-actions">
        <button class="quick-action-btn" id="attachPageBtn" title="Attach current page content">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
            <polyline points="10 9 9 9 8 9"/>
          </svg>
          Attach Page
        </button>
        <button class="quick-action-btn" id="attachSelectionBtn" title="Attach selected text">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 7h16"/>
            <path d="M4 12h16"/>
            <path d="M4 17h10"/>
            <circle cx="19" cy="17" r="2"/>
          </svg>
          Selection
        </button>
        <button class="quick-action-btn" id="smartSummarizeBtn" title="Summarize selected text or page">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 11H3"/>
            <path d="M15 11h6"/>
            <path d="M12 8v8"/>
            <circle cx="12" cy="12" r="9"/>
          </svg>
          Summarize Page
        </button>
        <button class="quick-action-btn" id="translateBtn" title="Translate selected text or page to Spanish">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 8l6 6"/>
            <path d="M4 14l6-6 2-3"/>
            <path d="M2 5h12"/>
            <path d="M7 2v3"/>
            <path d="M22 22l-5-5"/>
            <path d="M17 22l5-5"/>
          </svg>
          Translate Page
        </button>
        <button class="quick-action-btn" id="improveTextBtn" title="Improve selected text">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 20h9"/>
            <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
          </svg>
          Improve
        </button>
      </div>
      <div class="input-wrapper">
        <textarea 
          id="userInput" 
          class="input-field"
          placeholder="Type a message..."
          rows="1"></textarea>
        <button id="sendBtn" class="send-btn" disabled>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
      <div class="input-footer">
        <span class="footer-text">Powered by Gemini Nano ‚Ä¢ 100% private</span>
      </div>
    </div>
    </div> <!-- End of Chat Section -->

    <!-- Mail Compose Section - UX Laws Optimized -->
    <div class="main-tab-content" id="mailSection" style="display: none; flex-direction: column; flex: 1; overflow: hidden;">
      <div class="mail-compose-container compact optimized">
        
        <!-- Zeigarnik Effect: Show incomplete task indicator -->
        <div class="task-indicator" id="taskIndicator" style="display: none;">
          <span class="pulse-dot"></span>
          <span>Draft in progress...</span>
        </div>
        
        <!-- Serial Position Effect: Most important info at start -->
        <div class="mail-header compact">
          <h2>‚ú® Craft Mail</h2>
          <!-- Simplified progress (Occam's Razor) -->
          <div class="progress-flow">
            <span class="flow-step active">Write</span>
            <span class="flow-arrow">‚Üí</span>
            <span class="flow-step">Polish</span>
            <span class="flow-arrow">‚Üí</span>
            <span class="flow-step">Send</span>
          </div>
        </div>

        <!-- Compact Mail Form with Flow optimization -->
        <div class="mail-form compact flow-optimized">
          
          <!-- Chunking: Group related elements clearly -->
          <div class="mail-workspace">
            
            <!-- Primary Focus Area (Selective Attention) -->
            <div class="primary-focus">
              
              <!-- Input Section with Von Restorff Effect -->
              <div class="input-section highlighted">
                <label class="section-title">
                  <span class="step-number">1</span>
                  What's your message about?
                </label>
                
                <!-- Pareto Principle: Show only top 3 most-used templates -->
                <div class="top-templates">
                  <button type="button" class="template-card active" data-prompt="Follow up after meeting">
                    <span class="icon">üìß</span>
                    <span class="text">Follow-up</span>
                  </button>
                  <button type="button" class="template-card" data-prompt="Schedule meeting">
                    <span class="icon">üìÖ</span>
                    <span class="text">Meeting</span>
                  </button>
                  <button type="button" class="template-card" data-prompt="Request information">
                    <span class="icon">üìù</span>
                    <span class="text">Request</span>
                  </button>
                </div>
                
                <textarea id="mailDescription" 
                          placeholder="Describe your email in a few words..." 
                          rows="2"
                          class="focus-input"></textarea>
                
                <!-- Single primary action (Hick's Law reduction) -->
                <button class="generate-btn primary pulse" id="generateFromDescription">
                  <span class="btn-content">
                    Generate with AI
                    <span class="shortcut">‚Üµ</span>
                  </span>
                </button>
              </div>
              
              <!-- Output Section (Law of Common Region) -->
              <div class="output-section">
                <label class="section-title">
                  <span class="step-number">2</span>
                  Your Email
                </label>
                
                <!-- Subject with visual hierarchy -->
                <div class="email-preview">
                  <div class="email-field subject-field">
                    <label class="micro-label">Subject</label>
                    <input type="text" id="mailSubject" placeholder="AI will generate..." />
                  </div>
                  
                  <div class="email-field body-field">
                    <label class="micro-label">Message</label>
                    <textarea id="mailBody" 
                              placeholder="Your email will appear here..." 
                              rows="6"></textarea>
                  </div>
                </div>
                
                <!-- Choice Overload Fix: Simplified to 2 main options -->
                <div class="polish-options">
                  <button class="polish-btn" data-action="professional" title="Make Professional">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M12 2v10m0 10v-10m0 0l4-4m-4 4l-4-4"/>
                    </svg>
                    Professional
                  </button>
                  <button class="polish-btn" data-action="grammar" title="Fix Grammar">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M12 20h9M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z"/>
                    </svg>
                    Fix & Polish
                  </button>
                </div>
              </div>
            </div>
            
            <!-- Action Zone (Serial Position Effect: Important at end) -->
            <div class="action-zone">
              <!-- Peak-End Rule: Strong finish -->
              <button class="action-btn hero" id="copyMailBtn">
                <span class="btn-icon">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="9" y="9" width="13" height="13" rx="2"/>
                    <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
                  </svg>
                </span>
                <span class="btn-text">
                  <span class="main">Copy to Email</span>
                  <span class="sub">Gmail, Outlook, etc.</span>
                </span>
              </button>
              
              <!-- Secondary actions minimized (Fitts's Law) -->
              <div class="quick-actions">
                <button class="icon-btn" id="clearMailBtn" title="Start Over">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M5 7l1 12a2 2 0 002 2h8a2 2 0 002-2l1-12M9 7V4a1 1 0 011-1h4a1 1 0 011 1v3M10 11v6M14 11v6"/>
                  </svg>
                </button>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
    
    <!-- Agent Section - Chat Based Interface -->
    <div class="main-tab-content" id="agentSection" style="display: none; flex-direction: column; flex: 1; overflow: hidden;">
      <div class="agent-chat-container">
        <!-- Agent Chat Header -->
        <div class="agent-chat-header">
          <div class="agent-header-left">
            <h2>AI Agent Chat</h2>
            <div class="agent-selector">
              <button class="agent-quick-select active" data-agent="auto">
                <span class="agent-icon">ü§ñ</span>
                <span>Auto</span>
              </button>
              <button class="agent-quick-select" data-agent="researcher">
                <span class="agent-icon">üîç</span>
                <span>Research</span>
              </button>
              <button class="agent-quick-select" data-agent="coder">
                <span class="agent-icon">üíª</span>
                <span>Code</span>
              </button>
              <button class="agent-quick-select" data-agent="writer">
                <span class="agent-icon">‚úçÔ∏è</span>
                <span>Write</span>
              </button>
              <button class="agent-quick-select" data-agent="analyst">
                <span class="agent-icon">üìä</span>
                <span>Analyze</span>
              </button>
            </div>
          </div>
          <div class="agent-header-right">
            <div class="agent-status-indicator">
              <span class="status-dot"></span>
              <span class="status-text">Ready</span>
            </div>
            <button class="agent-clear-btn" id="clearAgentChat" title="Clear chat">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
            </button>
          </div>
        </div>
        
        <!-- Agent Chat Messages -->
        <div class="agent-chat-messages" id="agentChatMessages">
          <!-- Welcome message -->
          <div class="agent-welcome-message">
            <div class="welcome-icon">ü§ñ</div>
            <h3>Welcome to AI Agent Chat</h3>
            <p>I'm your AI agent assistant. I can help you with:</p>
            <div class="agent-capabilities">
              <div class="capability">
                <span class="cap-icon">üîç</span>
                <span class="cap-text"><strong>@research</strong> - Research any topic</span>
              </div>
              <div class="capability">
                <span class="cap-icon">üíª</span>
                <span class="cap-text"><strong>@code</strong> - Write and debug code</span>
              </div>
              <div class="capability">
                <span class="cap-icon">‚úçÔ∏è</span>
                <span class="cap-text"><strong>@write</strong> - Create content</span>
              </div>
              <div class="capability">
                <span class="cap-icon">üìä</span>
                <span class="cap-text"><strong>@analyze</strong> - Analyze data</span>
              </div>
            </div>
            <p class="welcome-tip">üí° <strong>Tip:</strong> You can interrupt me anytime by clicking "Stop" or typing "stop"</p>
          </div>
        </div>
        
        <!-- Agent Input Area -->
        <div class="agent-input-area">
          <!-- Agent Working Indicator -->
          <div class="agent-working-indicator" id="agentWorkingIndicator" style="display: none;">
            <div class="working-content">
              <div class="working-spinner"></div>
              <span class="working-text">Agent is working...</span>
              <button class="interrupt-btn" id="interruptAgent">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="6" y="4" width="4" height="16"/>
                  <rect x="14" y="4" width="4" height="16"/>
                </svg>
                Stop
              </button>
            </div>
            <div class="working-steps" id="workingSteps">
              <!-- Current step will appear here -->
            </div>
          </div>
          
          <!-- Input Controls -->
          <div class="agent-input-controls">
            <div class="agent-input-wrapper">
              <textarea id="agentChatInput" 
                        placeholder="Ask me anything or use @ to select an agent (e.g., @research climate change)" 
                        rows="1"></textarea>
              <div class="agent-input-actions">
                <button class="agent-send-btn" id="sendAgentMessage" disabled>
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                  </svg>
                </button>
              </div>
            </div>
            <div class="input-hints">
              <span class="hint">Press <kbd>Enter</kbd> to send, <kbd>Shift+Enter</kbd> for new line</span>
              <span class="hint">Use <kbd>@</kbd> to mention an agent</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="scripts/functions.js"></script>
  <script src="scripts/ai-apis.js"></script>
  <script src="scripts/sidepanel.js"></script>
  <script src="scripts/mail-compose.js"></script>
  <script src="scripts/agent.js"></script>
</body>
</html>
