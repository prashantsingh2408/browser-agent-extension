<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Memory Agent - Your AI-Powered Memory Bank (Web App)</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü§ñ</text></svg>">
  
  <!-- Load Chrome API adapter FIRST (for web app compatibility) -->
  <script src="scripts/chrome-adapter.js"></script>
  
  <!-- Load same CSS as extension -->
  <link rel="stylesheet" href="styles/sidepanel.css">
  <link rel="stylesheet" href="styles/ux-enhancements.css">
  
  <style>
    /* Web app specific adjustments */
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    }
    
    /* Make it full screen for web app */
    .app {
      width: 100vw;
      height: 100vh;
      max-width: 100%;
    }
    
    /* Add a badge showing it's web app mode */
    .webapp-badge {
      position: fixed;
      top: 10px;
      left: 10px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      z-index: 99999;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      opacity: 0;
      transform: translateX(-100px);
      transition: all 0.5s ease-out;
    }
    
    .webapp-badge.show {
      opacity: 1;
      transform: translateX(0);
    }
  </style>
</head>
<body>
  <!-- Web App Mode Badge -->
  <div class="webapp-badge" id="webappBadge">üåê Web App Mode</div>
  
  <!-- Content will be loaded from sidepanel.html -->
  <div id="app-root"></div>
  
  <script>
    console.log('üåê Memory Agent Web App - Loading...');
    
    // Fetch and load sidepanel.html content
    async function loadSidepanelContent() {
      try {
        const response = await fetch('sidepanel.html');
        const html = await response.text();
        
        // Parse HTML
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        
        // Get body content
        const bodyContent = doc.body.innerHTML;
        
        // Inject into app-root
        document.getElementById('app-root').innerHTML = bodyContent;
        
        console.log('‚úÖ Sidepanel content loaded');
        
        // Show web app badge
        setTimeout(() => {
          const badge = document.getElementById('webappBadge');
          if (badge) {
            badge.classList.add('show');
            // Auto-hide after 5 seconds
            setTimeout(() => {
              badge.style.opacity = '0';
              badge.style.transform = 'translateX(-100px)';
            }, 5000);
          }
        }, 500);
        
        // Load scripts in order (same as sidepanel.html)
        await loadScript('scripts/functions.js');
        await loadScript('scripts/ai-apis.js');
        await loadScript('scripts/sidepanel.js');
        await loadScript('scripts/mail-compose.js');
        await loadScript('scripts/agent.js');
        await loadScript('scripts/webdev.js');
        await loadScript('scripts/memory.js');
        await loadScript('scripts/settings.js');
        
        console.log('üéâ All scripts loaded - Initializing...');
        
        // Manually trigger initialization (scripts expect DOMContentLoaded)
        setTimeout(async () => {
          console.log('üîß Running initialization...');
          
          // Initialize AI
          if (typeof initializeAI === 'function') {
            await initializeAI();
            console.log('‚úÖ AI initialized');
          }
          
          // Initialize sessions
          if (typeof initializeSessions === 'function') {
            await initializeSessions();
            console.log('‚úÖ Sessions initialized');
          }
          
          // Setup event listeners
          if (typeof setupEventListeners === 'function') {
            setupEventListeners();
            console.log('‚úÖ Event listeners setup');
          }
          
          // Setup main navigation
          if (typeof setupMainNavigation === 'function') {
            setupMainNavigation();
            console.log('‚úÖ Main navigation setup');
          }
          
          // Initialize Memory system
          if (typeof initializeMemory === 'function') {
            await initializeMemory();
            console.log('‚úÖ Memory system initialized');
          }
          
          // Switch to Memory Agent tab by default for web app
          const memoryTab = document.querySelector('.main-nav-tab[data-tab="memory"]');
          if (memoryTab) {
            memoryTab.click();
            console.log('‚úÖ Switched to Memory Agent tab');
          }
          
          console.log('üéâ Memory Agent Web App ready!');
          
        }, 300);
        
      } catch (error) {
        console.error('Failed to load sidepanel content:', error);
        document.getElementById('app-root').innerHTML = `
          <div style="display: flex; align-items: center; justify-content: center; height: 100vh; flex-direction: column; gap: 20px;">
            <h2 style="color: #ea4335;">‚ö†Ô∏è Failed to Load</h2>
            <p>Could not load Memory Agent. Please refresh the page.</p>
            <button onclick="location.reload()" style="padding: 10px 20px; background: #4285f4; color: white; border: none; border-radius: 4px; cursor: pointer;">
              Refresh Page
            </button>
          </div>
        `;
      }
    }
    
    // Helper to load scripts dynamically
    function loadScript(src) {
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = src;
        script.onload = () => {
          console.log(`‚úÖ Loaded: ${src}`);
          resolve();
        };
        script.onerror = () => {
          console.error(`‚ùå Failed to load: ${src}`);
          reject(new Error(`Failed to load ${src}`));
        };
        document.body.appendChild(script);
      });
    }
    
    // Load content when page is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadSidepanelContent);
    } else {
      loadSidepanelContent();
    }
  </script>
</body>
</html>
